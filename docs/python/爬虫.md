# çˆ¬è™«

## ä¸€.å®‰è£…åº“
> pip3 install requests
>> æˆ‘çš„ç”µè„‘ä¸Šå®‰è£…äº†python27å’Œ36ï¼Œæ‰€ä»¥pip3å¯¹åº”çš„æ˜¯python3ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªï¼Œå°±pip install requestså³å¯
### 1. ä½¿ç”¨
```python
import requests
res = requests.get(url)

res.content # è·å–åˆ°äºŒè¿›åˆ¶æµ
res.text # è·å–åˆ°å†…å®¹
```
### 2. æŸ¥çœ‹ç½‘ç«™çˆ¬è™«åè®®
> ä¾‹ï¼š'https://www.baidu.com/robots.txt'

## äºŒ. å¸¸ç”¨å±æ€§
> ä¾‹å¦‚ print(res.status_code) # 200 <br />
> res.encoding = 'utf-8
<image-preview imgUrl="python/requests1.png" width='200'></image-preview>

## ä¸‰. è§£ææ•°æ®
> 1. æ‰‹åŠ¨å®‰è£…
>> pip3 install bs4
> 2. è§£ææ•°æ®ç”¨ï¼Œå³å°†çˆ¬å–çš„å†…å®¹è½¬æ¢æˆbså¯¹è±¡
### 1. bså¯¹è±¡
```python
import requests
from bs4 import BeautifulSoup

res = requests.get('http://xxxxxxx/index.html')
html = res.text
# ä¸¤ä¸ªå‚æ•°ï¼š ç¬¬ä¸€ä¸ªå¿…é¡»ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼›ç¬¬äºŒä¸ªæ˜¯è§£æå™¨ï¼Œæœ‰å¤šç§å¯é€‰
soup = BeautifulSoup(html, 'html.parser')
```
### 2. æŸ¥æ‰¾å†…å®¹
> æ‰¿æ¥ä¸Šæ–‡
```py
# find fing_all select
soup.find('div') # æŸ¥æ‰¾ç¬¬ä¸€ä¸ªdiv 'bs4.element.Tag'
result = soup.find_all('div') # æŸ¥æ‰¾å‡ºæ‰€æœ‰çš„div 'bs4.element.ResultSet'

# classå’Œç±»å†²çªï¼Œæ‰€æœ‰æ”¹æˆclass_ã€‚
soup.find('div', class_='show-list-item')

# find_allè¿”å›çš„ç»“æ„å‡ä¸º []
for i in result:
    print(i)
```
<image-preview imgUrl="python/find.png" width='200'></image-preview>

### 3. tagå¯¹è±¡
> findæŸ¥æ‰¾çš„ç»“æœæ˜¯tagå¯¹è±¡
> result.find(class_='xxxx') # None, å› ä¸ºdivä¸‹é¢æ²¡æœ‰tagäº†ã€‚åªæœ‰textå†…å®¹
>> å³result: \<div class='xxxx'> 123456 <\/div>
>> result.text # 123456 <br />

> åˆæ¯”å¦‚ aï¼š \<a href='https://xxxxxx'><\/a>
>> a['href] # https://xxxxxx

<image-preview imgUrl="python/tag.png" width='200'></image-preview>

### 4. å®è·µæ“ä½œ
```py
# è±†ç“£ç”µå½±æ’åï¼š åç§° + è¯„åˆ†
import requests
from bs4 import BeautifulSoup

headers={'user-agent':'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36'}
res = requests.get('https://movie.douban.com/chart', headers=headers)
html = res.text

soup = BeautifulSoup(html, 'html.parser')
cont = soup.find_all('div', class_='pl2')

for item in cont:
    name = item.find('div', class_='clearfix').text.replace(' ', '').replace('\n', '')
    a = item.find('a').text.replace(' ', '').replace('\n', '')
    print(a + ' : ' + name)


# æ‰“å°æ•ˆæœå¦‚ä¸‹ ğŸ‘‡
# é»‘å¯¡å¦‡/TheBlackWidow : 6.4(86959äººè¯„ä»·)
# æ˜æ—¥ä¹‹æˆ˜/å¹½çµå¾å‹Ÿ/å¹½çµåˆ†é£é˜Ÿ : 6.5(33369äººè¯„ä»·)
# æ™ºé½¿/Limbo : 7.3(9478äººè¯„ä»·)
# æ€æ‰‹å¦»å­çš„ä¿é•–/ä¿é•³æ•‘æ€æ‰‹2(æ¸¯)/ç‹ç‰Œä¿é•–2 : 6.3(10393äººè¯„ä»·)
# æˆ‘è¦æˆ‘ä»¬åœ¨ä¸€èµ·/10å¹´å¥³å‹/åå¹´å¥³å‹ : 6.1(72364äººè¯„ä»·)
# é˜³å…‰å§å¦¹æ·˜/ä¸­å›½ç‰ˆé˜³å…‰å§å¦¹æ·˜/SunnySisters : 4.5(32014äººè¯„ä»·)
# å…­äºº-æ³°å¦å°¼å…‹ä¸Šçš„ä¸­å›½å¹¸å­˜è€…/å…­äºº/å…­äººï¼šæ³°å¦å°¼å…‹å·ä¸Šçš„ä¸­å›½å¹¸å­˜è€… : 8.3(16500äººè¯„ä»·)
# å®è´è€æ¿2/å®è´è€æ¿2ï¼šå®¶æ—ä¼ä¸š/å®è´è€æ¿ï¼šå®¶å¤§ä¸šå¤§(å°) : 6.6(3867äººè¯„ä»·)
# æ€ªå¥‡å®…/æ¡é­‚é‚¨(æ¸¯)/æ€ªå¥‡å…¬å¯“ : 6.9(7206äººè¯„ä»·)
# å¤æ—¥å‹æ™´å¤©/ç››å¤å‹æ™´å¤©(æ¸¯)/è·¯å¡çš„å¤å¤©(å°) : 7.3(19038äººè¯„ä»·)

```


:::warning 
```py
# æ³¨æ„æ–‡ä»¶çš„åç§°(json1.py)ä¸èƒ½å’Œæ¨¡å—çš„åç§°ä¸€æ · <br />
import json
# str -> json
json.loads(x)
# json -> str
json.dumps(x)
```
:::


### 5. cookieå’Œsession
```py
# cookieå…ç™»é€»è¾‘
import requests
import json

url = 'https://xiaoke.kaikeba.com/example/wordpress/wp-login.php'
headers = {
    'User-Agent':'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36'
}
# é™¤äº†logã€pwdå…¶ä»–éƒ½æ˜¯é»˜è®¤å‚æ•°
data = {
    'log': 'kaikeba',
    'pwd': 'kaikeba888',
    'wp-submit': 'ç™»å½•',
    'redirect_to': 'https://xiaoke.kaikeba.com/example/wordpress/2019/10/17/%e5%bc%80%e8%af%be%e5%90%a7%e6%97%a0%e6%95%8c%e5%a5%bd%e5%90%83%e7%9a%84%e9%a3%9f%e5%a0%82%e4%b8%80%e5%91%a8%e8%8f%9c%e8%b0%b1/',
    'testcookie': '1'
}

session = requests.session()
session.post(url, headers=headers, data=data)

# å°†ç”Ÿæˆçš„cookieè½¬æ¢æˆ å­—å…¸
cookie_dict = requests.utils.dict_from_cookiejar(session.cookies)
# å°†å­—å…¸è½¬æ¢æˆ å­—ç¬¦ä¸²
cookie_str = json.dumps(cookie_dict)

# å°†cookieå†™å…¥æ–‡ä»¶å­˜èµ·æ¥
f = open('cookie.txt', 'w')
f.write(cookie_str)

```
```py
# è¯»å–å¹¶ä½¿ç”¨
cookie_txt = open('cookie.txt', 'r')
cookie_dict = json.loads(cookie_txt_read())
cookie = requests.utils.cookiejar_form_dict(cookie_dict)
session.cookies = cookie
```

```py
# tryæˆåŠŸå°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›å¦åˆ™æŠ¥é”™FileNotFoundErrorï¼Œèµ°except
try: 
    xxxxxxxxx
except FileNotFoundError: 
    xxxxxxxxx

# to do sometings
```